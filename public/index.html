<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GreenSpring</title>
  <script src="/socket.io/socket.io.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="/img/icons/favicon.ico">
  <style>
    .form-switch .form-check-input {
      width: 3em;
      height: 1.5em;
    }
  </style>
</head>
<body class="bg-body-secondary">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="./img/icons/ChatGPT Image 25. Juni 2025, 13_11_37.png" alt="Logo" width="40" height="40" class="me-2">
        <strong>GreenSpring</strong>
      </a>
      <div class="d-flex align-items-center ms-auto">
        <button id="toggleTheme" class="btn btn-outline-secondary me-2">
          <i class="bi bi-moon-stars"></i> Theme
        </button>
        <a href="admin.html" class="btn btn-success">
          <i class="bi bi-gear"></i> Admin
        </a>
      </div>
    </div>
  </nav>

  <!-- Main GPIO Grid -->
  <div class="container py-5">
    <div id="gpioContainer" class="row g-4"></div>
  </div>

  <!-- JavaScript stays below -->
  <script>
    const socket = io();
    const gpioContainer = document.getElementById('gpioContainer');
    const themeToggle = document.getElementById('toggleTheme');

    themeToggle.addEventListener('click', () => {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-bs-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-bs-theme', newTheme);
      themeToggle.innerHTML = newTheme === 'dark'
        ? '<i class="bi bi-sun"></i> Light Mode'
        : '<i class="bi bi-moon-stars"></i> Dark Mode';
    });

    socket.on('status', (states) => {
      gpioContainer.innerHTML = '';
      for (const pin in states) {
        const { label, value } = states[pin];
        const col = document.createElement('div');
        col.className = 'col-md-4';
        col.innerHTML = `
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-cpu me-2"></i>${label}</h5>
              <h6 class="card-subtitle mb-3 text-muted">GPIO ${pin}</h6>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch"
                  id="switch-${pin}" ${value ? 'checked' : ''} onchange="toggle(${pin})">
                <label class="form-check-label" for="switch-${pin}">
                  ${value ? 'ON' : 'OFF'}
                </label>
              </div>
            </div>
          </div>
        `;
        gpioContainer.appendChild(col);
      }
    });

    function toggle(pin) {
      socket.emit('toggle', pin);
    }
  </script>
</body>
</html>
